<section class="section section-{{ section.id }}-padding gradient color-{{ section.settings.color_scheme }}">
  {{ 'component-rating.css' | asset_url | stylesheet_tag }}
  {{ 'component-slider.css' | asset_url | stylesheet_tag }}

  {%- style -%}
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
      padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
    }
    @media screen and (min-width: 750px) {
      .section-{{ section.id }}-padding {
        padding-top: {{ section.settings.padding_top }}px;
        padding-bottom: {{ section.settings.padding_bottom }}px;
      }
    }
    .testimonials__item {
      border: 1px solid rgba(var(--color-foreground), 0.08);
      border-radius: var(--text-boxes-radius);
      padding: 2rem;
      background: rgb(var(--color-background));
    }
    .testimonials__author { margin-top: 1rem; font-weight: 600; }
    .testimonials__rating { margin: 0.5rem 0 1rem; }
  {%- endstyle -%}

  <div class="page-width">
    {%- if section.settings.title != blank -%}
      <div class="title-wrapper center">
        <h2 class="title {{ section.settings.heading_size }}">{{ section.settings.title | escape }}</h2>
      </div>
    {%- endif -%}

    <slideshow-component class="slider-mobile-gutter">
      <div
        id="Slider-{{ section.id }}"
        class="grid grid--1-col slider slider--everywhere"
        role="list"
        {% if section.blocks.size > section.settings.slides_per_page %}
          aria-label="{{ 'general.slider.name' | t }}"
        {% endif %}
      >
        {%- for block in section.blocks -%}
          <div
            id="Slide-{{ block.id }}"
            class="grid__item slider__slide slideshow__slide"
            tabindex="-1"
            role="group"
            {% if section.blocks.size > section.settings.slides_per_page %}
              aria-roledescription="{{ 'sections.slideshow.slide' | t }}"
              aria-label="{{ forloop.index }} {{ 'general.slider.of' | t }} {{ forloop.length }}"
            {% endif %}
            {{ block.shopify_attributes }}
          >
            <div class="testimonials__item">
              {%- if block.settings.rating > 0 -%}
                <div
                  class="rating testimonials__rating"
                  role="img"
                  aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: block.settings.rating, rating_max: 5 }}"
                >
                  <span
                    aria-hidden="true"
                    class="rating-star"
                    style="--rating: {{ block.settings.rating | floor }}; --rating-max: 5; --rating-decimal: {{ block.settings.rating | modulo: 1 }};"
                  ></span>
                </div>
              {%- endif -%}
              {%- if block.settings.quote != blank -%}
                <div class="rte">{{ block.settings.quote }}</div>
              {%- endif -%}
              {%- if block.settings.author != blank -%}
                <div class="testimonials__author">{{ block.settings.author | escape }}</div>
              {%- endif -%}
              {%- if block.settings.product != blank -%}
                <div class="element-margin-top">
                  {% render 'card-product',
                    card_product: block.settings.product,
                    media_aspect_ratio: 'square',
                    show_rating: false,
                    lazy_load: true,
                    section_id: section.id,
                    skip_styles: true
                  %}
                </div>
              {%- endif -%}
            </div>
          </div>
        {%- endfor -%}
      </div>

      {%- if section.blocks.size > section.settings.slides_per_page -%}
        <div class="slider-buttons">
          <button
            type="button"
            class="slider-button slider-button--prev"
            name="previous"
            aria-label="{{ 'general.slider.previous_slide' | t }}"
          >
            <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
          </button>
          <div class="slider-counter slider-counter--counter caption">
            <span class="slider-counter--current">1</span>
            <span aria-hidden="true"> / </span>
            <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
            <span class="slider-counter--total">{{ section.blocks.size }}</span>
          </div>
          <button
            type="button"
            class="slider-button slider-button--next"
            name="next"
            aria-label="{{ 'general.slider.next_slide' | t }}"
          >
            <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
          </button>
        </div>
      {%- endif -%}
    </slideshow-component>
  </div>
</section>

{% schema %}
{
  "name": "Testimonials",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "text", "id": "title", "label": "Heading", "default": "Testimonials" },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "default": "h2",
      "options": [
        { "value": "h1", "label": "H1" },
        { "value": "h2", "label": "H2" },
        { "value": "h3", "label": "H3" }
      ]
    },
    {
      "type": "range",
      "id": "slides_per_page",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 1,
      "label": "Slides per view"
    },
    { "type": "color_scheme", "id": "color_scheme", "label": "t:sections.all.colors.label", "default": "scheme-1" },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "richtext",
          "id": "quote",
          "label": "Quote",
          "default": "<p>Wundersch√∂ner Schmuck und toller Service!<\/p>"
        },
        { "type": "text", "id": "author", "label": "Author", "default": "Kundin" },
        { "type": "range", "id": "rating", "label": "Rating (0-5)", "min": 0, "max": 5, "step": 0.5, "default": 5 },
        { "type": "product", "id": "product", "label": "Related product (optional)" }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [{ "name": "Testimonials", "category": "Text" }]
}
{% endschema %}

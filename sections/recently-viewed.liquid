<section class="section section-{{ section.id }}-padding gradient color-{{ section.settings.color_scheme }}">
  {{ 'component-card.css' | asset_url | stylesheet_tag }}
  <script>
    (function(){
      var KEY='fh_recent_v1';
      function get(){try{return JSON.parse(localStorage.getItem(KEY))||[];}catch(e){return [];}}
      function set(ids){localStorage.setItem(KEY,JSON.stringify(ids.slice(0,{{ section.settings.max_items }})));}
      function add(id){if(!id)return;var ids=get();ids=ids.filter(function(x){return x!==id});ids.unshift(id);set(ids);}
      document.addEventListener('DOMContentLoaded', function(){
        {% if request.page_type == 'product' %}add('{{ product.id }}');{% endif %}
        var root=document.getElementById('recently-viewed-{{ section.id }}');
        var ids=get();
        if(!ids.length){root.innerHTML='';return;}
        fetch(window.routes.cart_url.replace('/cart','/recommendations/products?product_id='+ids[0]+'&limit={{ section.settings.max_items }}'))
          .then(function(r){return r.text()})
          .then(function(html){root.innerHTML=html;document.dispatchEvent(new CustomEvent('wishlist:refresh',{detail:{root:root}}));});
      });
    })();
  </script>
  <div class="page-width">
    <div class="title-wrapper">
      <h2 class="title {{ section.settings.heading_size }}">{{ section.settings.title }}</h2>
    </div>
    <div id="recently-viewed-{{ section.id }}"></div>
  </div>
</section>

{% schema %}
{
  "name": "Recently viewed",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "text", "id": "title", "label": "Heading", "default": "KÃ¼rzlich angesehen" },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "default": "h2",
      "options": [
        { "value": "h1", "label": "H1" },
        { "value": "h2", "label": "H2" },
        { "value": "h3", "label": "H3" }
      ]
    },
    { "type": "range", "id": "max_items", "min": 2, "max": 12, "step": 1, "default": 4, "label": "Max items" },
    { "type": "color_scheme", "id": "color_scheme", "label": "t:sections.all.colors.label", "default": "scheme-1" },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ],
  "presets": [{ "name": "Recently viewed", "category": "Products" }]
}
{% endschema %}
